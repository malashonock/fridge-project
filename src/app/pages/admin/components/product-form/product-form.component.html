<header class="header">
  <h2 matDialogTitle>{{ title }}</h2>
  <button mat-icon-button mat-dialog-close><mat-icon>close</mat-icon></button>
</header>

<form [formGroup]="form">
  <mat-dialog-content class="form-fields">
    <!-- Image -->
    <!-- TODO: implement custom image-input component -->
    <div class="form-fields__image">
      <label for="image">Product image</label>
      <input type="file" id="image" name="image" formControlName="image" />
    </div>

    <!-- Category -->
    <mat-form-field
      appearance="outline"
      subscriptSizing="dynamic"
      class="form-fields__category"
    >
      <mat-label>Product category</mat-label>
      <mat-select id="category" formControlName="category" cdkFocusInitial>
        <mat-option
          *ngFor="let productCategory of productCategories"
          [value]="productCategory.value"
          >{{ productCategory.label }}</mat-option
        >
      </mat-select>
      <mat-error *ngIf="form.get('category')?.hasError('required')">
        Product category is required
      </mat-error>
    </mat-form-field>

    <!-- Name -->
    <mat-form-field
      appearance="outline"
      subscriptSizing="dynamic"
      class="form-fields__name"
    >
      <mat-label>Product name</mat-label>
      <input matInput id="name" name="name" formControlName="name" />
      <mat-error *ngIf="form.get('name')?.hasError('required')">
        Product name is required
      </mat-error>
    </mat-form-field>

    <!-- Price -->
    <mat-form-field
      appearance="outline"
      subscriptSizing="dynamic"
      class="form-fields__price"
    >
      <mat-label>Price, BYN</mat-label>
      <input
        matInput
        type="number"
        step="0.01"
        min="0.01"
        id="price"
        name="price"
        formControlName="price"
      />
      <mat-error *ngIf="form.get('price')?.hasError('required')">
        Product price is required
      </mat-error>
      <mat-error *ngIf="form.get('price')?.hasError('min')">
        Product price cannot be negative
      </mat-error>
    </mat-form-field>

    <!-- Ingredients -->
    <mat-form-field
      appearance="outline"
      subscriptSizing="dynamic"
      class="form-fields__ingredients"
    >
      <mat-label>Ingredients</mat-label>
      <textarea
        matInput
        id="ingredients"
        name="ingredients"
        formControlName="ingredients"
        cdkTextareaAutosize
      >
      </textarea>
    </mat-form-field>

    <!-- Nutrients -->
    <fieldset formGroupName="nutrients" class="form-fields__nutrients">
      <legend>Nutrients, g</legend>

      <mat-form-field
        *ngFor="let nutrient of ['protein', 'fat', 'carbs']"
        appearance="outline"
        subscriptSizing="dynamic"
        [class]="'form-fields__nutrient nutrients__' + nutrient"
      >
        <mat-label>{{ nutrient | titlecase }}</mat-label>
        <input
          matInput
          type="number"
          min="0"
          [id]="'nutrient-' + nutrient"
          [name]="'nutrient-' + nutrient"
          [formControlName]="nutrient"
        />
        <mat-error
          *ngIf="form.get('nutrients.' + nutrient)?.hasError('required')"
        >
          {{ nutrient | titlecase }} content is required
        </mat-error>
        <mat-error *ngIf="form.get('nutrients.' + nutrient)?.hasError('min')">
          {{ nutrient | titlecase }} content cannot be negative
        </mat-error>
      </mat-form-field>
    </fieldset>

    <!-- Weight -->
    <fieldset formGroupName="weight" class="form-fields__weight">
      <legend>Weight</legend>

      <mat-form-field
        appearance="outline"
        subscriptSizing="dynamic"
        class="form-fields__weight-value"
      >
        <mat-label>Value</mat-label>
        <input
          matInput
          type="number"
          min="0"
          id="weight-value"
          name="weight-value"
          formControlName="value"
        />
        <mat-error *ngIf="form.get('weight.value')?.hasError('required')">
          Weight value is required
        </mat-error>
        <mat-error *ngIf="form.get('weight.value')?.hasError('min')">
          Weight cannot be negative
        </mat-error>
      </mat-form-field>

      <mat-form-field
        appearance="outline"
        subscriptSizing="dynamic"
        class="form-fields__weight-unit"
      >
        <mat-label>Unit</mat-label>
        <mat-select id="weight-unit" formControlName="unit">
          <mat-option
            *ngFor="let weightUnit of weightUnits"
            [value]="weightUnit.value"
            >{{ weightUnit.label }}</mat-option
          >
        </mat-select>
        <mat-error *ngIf="form.get('weight.unit')?.hasError('required')">
          Weight unit is required
        </mat-error>
      </mat-form-field>
    </fieldset>

    <!-- Energy value -->
    <mat-form-field
      appearance="outline"
      subscriptSizing="dynamic"
      class="form-fields__energy-value"
    >
      <mat-label>Energy value, kcal</mat-label>
      <input
        matInput
        type="number"
        min="0"
        step="1"
        id="energy-value"
        name="energy-value"
        formControlName="kiloCalories"
      />
      <mat-error *ngIf="form.get('kiloCalories')?.hasError('required')">
        Energy value is required
      </mat-error>
      <mat-error *ngIf="form.get('kiloCalories')?.hasError('min')">
        Energy value cannot be negative
      </mat-error>
    </mat-form-field>

    <!-- Shelf life -->
    <fieldset formGroupName="shelfLife" class="form-fields__shelf-life">
      <legend>Shelf life</legend>

      <mat-form-field
        *ngFor="let period of ['months', 'weeks', 'days', 'hours']"
        appearance="outline"
        subscriptSizing="dynamic"
        [class]="'form-fields__shelf-life-period shelf-life__' + period"
      >
        <mat-label>{{ period | titlecase }}</mat-label>
        <input
          matInput
          type="number"
          min="0"
          step="1"
          [id]="'shelf-life' + period"
          [name]="'shelf-life' + period"
          [formControlName]="period"
        />
        <mat-error *ngIf="form.get('shelfLife.' + period)?.hasError('min')">
          {{ period | titlecase }} value cannot be negative
        </mat-error>
        <mat-error *ngIf="form.get('shelfLife.' + period)?.hasError('pattern')">
          {{ period | titlecase }} value must be an integer
        </mat-error>
      </mat-form-field>
    </fieldset>
  </mat-dialog-content>

  <mat-dialog-actions align="center">
    <button mat-raised-button mat-dialog-close type="submit" color="primary">
      {{ submitText }}
    </button>
  </mat-dialog-actions>
</form>
